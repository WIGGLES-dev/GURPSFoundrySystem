!function(t){var e={};function a(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=5)}([function(t,e,a){var n=a(1);n.prototype.formulaEval=function(){"use strict";for(var t,e,a,n=[],o=this.value,s=0;s<o.length;s++)1===o[s].type||3===o[s].type?n.push({value:3===o[s].type?o[s].show:o[s].value,type:1}):13===o[s].type?n.push({value:o[s].show,type:1}):0===o[s].type?n[n.length-1]={value:o[s].show+("-"!=o[s].show?"(":"")+n[n.length-1].value+("-"!=o[s].show?")":""),type:0}:7===o[s].type?n[n.length-1]={value:(1!=n[n.length-1].type?"(":"")+n[n.length-1].value+(1!=n[n.length-1].type?")":"")+o[s].show,type:7}:10===o[s].type?(t=n.pop(),e=n.pop(),"P"===o[s].show||"C"===o[s].show?n.push({value:"<sup>"+e.value+"</sup>"+o[s].show+"<sub>"+t.value+"</sub>",type:10}):n.push({value:(1!=e.type?"(":"")+e.value+(1!=e.type?")":"")+"<sup>"+t.value+"</sup>",type:1})):2===o[s].type||9===o[s].type?(t=n.pop(),e=n.pop(),n.push({value:(1!=e.type?"(":"")+e.value+(1!=e.type?")":"")+o[s].show+(1!=t.type?"(":"")+t.value+(1!=t.type?")":""),type:o[s].type})):12===o[s].type&&(t=n.pop(),e=n.pop(),a=n.pop(),n.push({value:o[s].show+"("+a.value+","+e.value+","+t.value+")",type:12}));return n[0].value},t.exports=n},function(t,e,a){var n=a(2);n.prototype.postfixEval=function(t){"use strict";(t=t||{}).PI=Math.PI,t.E=Math.E;for(var e,a,o,s=[],r=this.value,l=void 0!==t.n,u=0;u<r.length;u++)1===r[u].type?s.push({value:r[u].value,type:1}):3===r[u].type?s.push({value:t[r[u].value],type:1}):0===r[u].type||7===r[u].type?void 0===s[s.length-1].type?s[s.length-1].value.push(r[u]):s[s.length-1].value=r[u].value(s[s.length-1].value):8===r[u].type?(e=s.pop(),a=s.pop(),s.push({type:1,value:r[u].value(a.value,e.value)})):10===r[u].type?(e=s.pop(),void 0===(a=s.pop()).type?(a.value=a.concat(e),a.value.push(r[u]),s.push(a)):void 0===e.type?(e.unshift(a),e.push(r[u]),s.push(e)):s.push({type:1,value:r[u].value(a.value,e.value)})):2===r[u].type||9===r[u].type?(e=s.pop(),void 0===(a=s.pop()).type?(console.log(a),(a=a.concat(e)).push(r[u]),s.push(a)):void 0===e.type?(e.unshift(a),e.push(r[u]),s.push(e)):s.push({type:1,value:r[u].value(a.value,e.value)})):12===r[u].type?(void 0!==(e=s.pop()).type&&(e=[e]),a=s.pop(),o=s.pop(),s.push({type:1,value:r[u].value(o.value,a.value,new n(e))})):13===r[u].type&&(l?s.push({value:t[r[u].value],type:3}):s.push([r[u]]));if(s.length>1)throw new n.exception("Uncaught Syntax error");return s[0].value>1e15?"Infinity":parseFloat(s[0].value.toFixed(15))},n.eval=function(t,e,a){return void 0===e?this.lex(t).toPostfix().postfixEval():void 0===a?void 0!==e.length?this.lex(t,e).toPostfix().postfixEval():this.lex(t).toPostfix().postfixEval(e):this.lex(t,e).toPostfix().postfixEval(a)},t.exports=n},function(t,e,a){var n=a(3);n.prototype.toPostfix=function(){"use strict";for(var t,e,a,o,s,r=[],l=[{value:"(",type:4,pre:0}],u=this.value,i=1;i<u.length;i++)if(1===u[i].type||3===u[i].type||13===u[i].type)1===u[i].type&&(u[i].value=Number(u[i].value)),r.push(u[i]);else if(4===u[i].type)l.push(u[i]);else if(5===u[i].type)for(;4!==(e=l.pop()).type;)r.push(e);else if(11===u[i].type){for(;4!==(e=l.pop()).type;)r.push(e);l.push(e)}else{o=(t=u[i]).pre,a=(s=l[l.length-1]).pre;var h="Math.pow"==s.value&&"Math.pow"==t.value;if(o>a)l.push(t);else{for(;a>=o&&!h||h&&o<a;)e=l.pop(),s=l[l.length-1],r.push(e),a=s.pre,h="Math.pow"==t.value&&"Math.pow"==s.value;l.push(t)}}return new n(r)},t.exports=n},function(t,e,a){var n=a(4);function o(t,e){for(var a=0;a<t.length;a++)t[a]+=e;return t}var s=["sin","cos","tan","pi","(",")","P","C","asin","acos","atan","7","8","9","int","cosh","acosh","ln","^","root","4","5","6","/","!","tanh","atanh","Mod","1","2","3","*","sinh","asinh","e","log","0",".","+","-",",","Sigma","n","Pi","pow"],r=["sin","cos","tan","&pi;","(",")","P","C","asin","acos","atan","7","8","9","Int","cosh","acosh"," ln","^","root","4","5","6","&divide;","!","tanh","atanh"," Mod ","1","2","3","&times;","sinh","asinh","e"," log","0",".","+","-",",","&Sigma;","n","&Pi;","pow"],l=[n.math.sin,n.math.cos,n.math.tan,"PI","(",")",n.math.P,n.math.C,n.math.asin,n.math.acos,n.math.atan,"7","8","9",Math.floor,n.math.cosh,n.math.acosh,Math.log,Math.pow,Math.sqrt,"4","5","6",n.math.div,n.math.fact,n.math.tanh,n.math.atanh,n.math.mod,"1","2","3",n.math.mul,n.math.sinh,n.math.asinh,"E",n.math.log,"0",".",n.math.add,n.math.sub,",",n.math.sigma,"n",n.math.Pi,Math.pow],u={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0},i=[0,0,0,3,4,5,10,10,0,0,0,1,1,1,0,0,0,0,10,0,1,1,1,2,7,0,0,2,1,1,1,2,0,0,3,0,1,6,9,9,11,12,13,12,8],h={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0},p={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},c={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},f={},v={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},d={1:!0},m=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];function g(t,e,a,n){for(var o=0;o<n;o++)if(t[a+o]!==e[o])return!1;return!0}n.addToken=function(t){for(var e=0;e<t.length;e++){var a=t[e].token.length,n=-1;if(a<m.length)for(var o=0;o<m[a].length;o++)if(t[e].token===m[a][o]){n=s.indexOf(m[a][o]);break}-1===n?(s.push(t[e].token),i.push(t[e].type),m.length<=t[e].token.length&&(m[t[e].token.length]=[]),m[t[e].token.length].push(t[e].token),l.push(t[e].value),r.push(t[e].show)):(s[n]=t[e].token,i[n]=t[e].type,l[n]=t[e].value,r[n]=t[e].show)}},n.lex=function(t,e){"use strict";var a,y,w,_,M={value:n.math.changeSign,type:0,pre:21,show:"-"},x={value:")",show:")",type:5,pre:0},S={value:"(",type:4,pre:0,show:"("},b=[S],P=[],E=t,C=h,O=0,F=f,D="";void 0!==e&&n.addToken(e);var R={};for(y=0;y<E.length;y++)if(" "!==E[y]){for(a="",w=E.length-y>m.length-2?m.length-1:E.length-y;w>0;w--)if(void 0!==m[w])for(_=0;_<m[w].length;_++)g(E,m[w][_],y,w)&&(a=m[w][_],_=m[w].length,w=0);if(y+=a.length-1,""===a)throw new n.Exception("Can't understand after "+E.slice(y));var T,k=s.indexOf(a),I=a,$=i[k],j=l[k],N=u[$],q=r[k],A=b[b.length-1];for(T=P.length;T--&&0===P[T];)if(-1!==[0,2,3,4,5,9,11,12,13].indexOf($)){if(!0!==C[$])throw new n.Exception(a+" is not allowed after "+D);b.push(x),C=p,F=v,o(P,-1).pop()}if(!0!==C[$])throw new n.Exception(a+" is not allowed after "+D);if(!0===F[$]&&($=2,j=n.math.mul,q="&times;",N=3,y-=a.length),R={value:j,type:$,pre:N,show:q},0===$)C=h,F=f,o(P,2).push(2),b.push(R),b.push(S);else if(1===$)1===A.type?(A.value+=j,o(P,1)):b.push(R),C=p,F=c;else if(2===$)C=h,F=f,o(P,2),b.push(R);else if(3===$)b.push(R),C=p,F=v;else if(4===$)o(P,1),O++,C=h,F=f,b.push(R);else if(5===$){if(!O)throw new n.Exception("Closing parenthesis are more than opening one, wait What!!!");O--,C=p,F=v,b.push(R)}else if(6===$){if(A.hasDec)throw new n.Exception("Two decimals are not allowed in one number");1!==A.type&&(A={value:0,type:1,pre:0},b.push(A),o(P,-1)),C=d,o(P,1),F=f,A.value+=j,A.hasDec=!0}else 7===$&&(C=p,F=v,o(P,1),b.push(R));8===$?(C=h,F=f,o(P,4).push(4),b.push(R),b.push(S)):9===$?(9===A.type?A.value===n.math.add?(A.value=j,A.show=q,o(P,1)):A.value===n.math.sub&&"-"===q&&(A.value=n.math.add,A.show="+",o(P,1)):5!==A.type&&7!==A.type&&1!==A.type&&3!==A.type&&13!==A.type?"-"===I&&(C=h,F=f,o(P,2).push(2),b.push(M),b.push(S)):(b.push(R),o(P,2)),C=h,F=f):10===$?(C=h,F=f,o(P,2),b.push(R)):11===$?(C=h,F=f,b.push(R)):12===$?(C=h,F=f,o(P,6).push(6),b.push(R),b.push(S)):13===$&&(C=p,F=v,b.push(R)),o(P,-1),D=a}for(T=P.length;T--&&0===P[T];)b.push(x),o(P,-1).pop();if(!0!==C[5])throw new n.Exception("complete the expression");for(;O--;)b.push(x);return b.push(x),new n(b)},t.exports=n},function(t,e){var a=function(t){this.value=t};a.math={isDegree:!0,acos:function(t){return a.math.isDegree?180/Math.PI*Math.acos(t):Math.acos(t)},add:function(t,e){return t+e},asin:function(t){return a.math.isDegree?180/Math.PI*Math.asin(t):Math.asin(t)},atan:function(t){return a.math.isDegree?180/Math.PI*Math.atan(t):Math.atan(t)},acosh:function(t){return Math.log(t+Math.sqrt(t*t-1))},asinh:function(t){return Math.log(t+Math.sqrt(t*t+1))},atanh:function(t){return Math.log((1+t)/(1-t))},C:function(t,e){var n=1,o=t-e,s=e;s<o&&(s=o,o=e);for(var r=s+1;r<=t;r++)n*=r;return n/a.math.fact(o)},changeSign:function(t){return-t},cos:function(t){return a.math.isDegree&&(t=a.math.toRadian(t)),Math.cos(t)},cosh:function(t){return(Math.pow(Math.E,t)+Math.pow(Math.E,-1*t))/2},div:function(t,e){return t/e},fact:function(t){if(t%1!=0)return"NaN";for(var e=1,a=2;a<=t;a++)e*=a;return e},inverse:function(t){return 1/t},log:function(t){return Math.log(t)/Math.log(10)},mod:function(t,e){return t%e},mul:function(t,e){return t*e},P:function(t,e){for(var a=1,n=Math.floor(t)-Math.floor(e)+1;n<=Math.floor(t);n++)a*=n;return a},Pi:function(t,e,a){for(var n=1,o=t;o<=e;o++)n*=Number(a.postfixEval({n:o}));return n},pow10x:function(t){for(var e=1;t--;)e*=10;return e},sigma:function(t,e,a){for(var n=0,o=t;o<=e;o++)n+=Number(a.postfixEval({n:o}));return n},sin:function(t){return a.math.isDegree&&(t=a.math.toRadian(t)),Math.sin(t)},sinh:function(t){return(Math.pow(Math.E,t)-Math.pow(Math.E,-1*t))/2},sub:function(t,e){return t-e},tan:function(t){return a.math.isDegree&&(t=a.math.toRadian(t)),Math.tan(t)},tanh:function(t){return a.sinha(t)/a.cosha(t)},toRadian:function(t){return t*Math.PI/180}},a.Exception=function(t){this.message=t},t.exports=a},function(t,e,a){"use strict";a.r(e);var n=a(0),o=a.n(n);class s extends class{constructor(){this._foundryRoll=null}get evaluatedFormula(){return this._foundryRoll.formula}get total(){return this._foundryRoll.total}get foundryDice(){return this._foundryRoll.dice}roll(){return this._foundryRoll.roll(),this}}{static fromFormula(t){return new s({formula:t})}static fromData({level:t,trait:e=null,modifiers:a=null}){return new s({level:t,trait:e,modifiers:a})}constructor({level:t=null,trait:e=null,formula:a=null,modifiers:n=null}){if(super(),null===a&&null===t)throw new Error("Attempted to create a SuccessRoll with both level and formula equal to null; at least one of them must be non-null!");if(null!==a){const o=(a+"").match(/^(([a-zA-Z][^-\r\n\f\0]*)-)?( *\d+)(( *[+-] *[0-9]+)*)$/);if(null===o)throw new Error(`Can't parse SuccessRoll formula '${a}' - it must adhere to the following format: [<trait name beginning with a letter and containing no - signs>-]<level>[<numeric modifiers including the + and - signs, and optionally spaces>]`);e=o[2]||null,t=parseInt(o[3],10),n=o[4]||null}this._foundryRoll=new Roll("3d6"),this._level=t,this._trait=e,this._modifiers=n,this._evaluatedModifiers=n?o.a.eval(n):0,this._isSuccess=null,this._marginOfSuccess=null,this._isCritFail=!1,this._isCritSuccess=!1}get level(){return this._level}get trait(){return this._trait}get modifiers(){return this._modifiers}get evaluatedLevel(){return this.level+this._evaluatedModifiers}get isSuccess(){return this._foundryRoll._rolled?this._isSuccess:null}get marginOfSuccess(){return this._foundryRoll._rolled?this._marginOfSuccess:null}get isCritFail(){return this._foundryRoll._rolled?this._isCritFail:null}get isCritSuccess(){return this._foundryRoll._rolled?this._isCritSuccess:null}roll(){return super.roll(),this._marginOfSuccess=this.level-this.total+this._evaluatedModifiers,this._isSuccess=this._marginOfSuccess>=0,(this.total<=4||this.total<=6&&this.marginOfSuccess>=10)&&(this._isCritSuccess=!0,this._isSuccess=!0),17===this.total&&(this._isSuccess=!1),(18===this.total||17===this.total&&this.level+this._evaluatedModifiers<=15||this.marginOfSuccess<=-10)&&(this._isCritFail=!0,this._isSuccess=!1),this}}class r extends class{getTooltip(t){const e=this,a={formula:t.evaluatedFormula,total:t.total,parts:t.foundryDice.map(t=>{const a=e._getWorstDieFace(t),n=e._getBestDieFace(t);return{formula:t.formula,total:t.total,faces:t.faces,rolls:t.rolls.map(e=>({result:e.roll,classes:[t.constructor.name.toLowerCase(),"d"+t.faces,e.roll===a?"min":null,e.roll===n?"max":null].filter(t=>t).join(" ")}))}})};return renderTemplate(CONFIG.Dice.tooltip,a)}_getBestDieFace(t){return Math.max(...t.sides)}_getWorstDieFace(t){return Math.min(...t.sides)}async render(t,e={},a={}){return e=mergeObject({template:"modules/GURPS-Foundry-Roll-Templates/templates/roll.html",useTooltip:!0},e),a=mergeObject({user:game.user._id,flavor:null,formula:this._getFormula(t),tooltip:e.useTooltip?await this.getTooltip(t):"",total:this._getTotal(t)},a),renderTemplate(e.template,a)}_getFormula(t){return t.evaluatedFormula}_getTotal(t){return Math.round(100*t.total)/100}}{_getBestDieFace(t){return Math.min(...t.sides)}_getWorstDieFace(t){return Math.max(...t.sides)}_getFormula(t){let e=t.trait?t.trait+"-":"Rolled against ";return e=`${e}${t.level}`,null!==t.modifiers&&(e=`${e}${t.modifiers}<b style="padding-left: 10px">= ${t.evaluatedLevel}</b>`),e}_getTotal(t){let e=t.isSuccess?"Success":"Failure";if(t.isCritSuccess||t.isCritFail){e=`<b style="color:${t.isCritSuccess?"#008800":"#DD0000"}">Critical ${e}</b>`}return`${e} by ${t.isSuccess?t.marginOfSuccess:-t.marginOfSuccess}`}}Hooks.on("chatMessage",(t,e,a)=>{if(0===e.indexOf("!sr")){let t=new s({level:10,trait:"Stealth"});return t.roll(),(new r).render(t).then(t=>{ChatMessage.create({content:t,user:game.user._id,type:CONST.CHAT_MESSAGE_TYPES.OTHER})}),!1}})}]);
//# sourceMappingURL=gurps-foundry-roll-chatcmd.bundle.js.map